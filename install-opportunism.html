<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>fogbow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="http://www.fogbowcloud.org/theme/img/icons/favicon.ico" />
    <link rel="stylesheet" href="http://www.fogbowcloud.org/theme/css/bootstrap.css">
  </head>
  <body>
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="../" class="navbar-brand">fogbow</a>
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <ul class="nav navbar-nav navbar-right">
          <li class="active">
            <a href="http://www.fogbowcloud.org/install-opportunism.html">Install</a>
          </li>
          <li >
            <a href="http://www.fogbowcloud.org/architecture.html">How it works</a>
          </li>
          <li><a href="#">Contact us</a></li>
        </ul>
      </div>
    </div>
     <div class="container">
      <div class="bs-docs-section">
    <div class="bs-docs-section">
    <div class="row">
      <div class="col-lg-4">
      	<br>
        <ul class="nav nav-pills nav-stacked" style="max-width: 300px;">
            <li class="active">
            	<a href="install-opportunism">Opportunism</a>
            </li>
        </ul>
      </div>
      <div class="col-lg-8 page-content">
      	<h1>Installation</h1>
<p>The installation of the opportunistic component is very simple.</p>
<p>It uses Distutils from python to be installed, so all you need to do is to get the latest code and run the setup.py 
and all packages and scripts will be allocated to the right place.</p>
<div class="highlight"><pre><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="o">:</span><span class="c1">//github.com/fogbow/fogbow-opportunism.git</span>
<span class="n">cd</span> <span class="n">fogbow</span><span class="o">-</span><span class="n">opportunism</span>
<span class="n">sudo</span> <span class="n">python</span> <span class="n">setup</span><span class="p">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>


<p>The opportunistic component files will be located at /var/lib/fogbow-opportunism.</p>
<h1>Configuration</h1>
<p>After installation the user can configure which monitors will be used and how much time the powernap will wait before setting the host idle.</p>
<p>The configuration file is located at /etc/powernap/config</p>
<p>Follows few properties that you can customize</p>
<div class="highlight"><pre><span class="cp"># Number of seconds that all monitors must have no activity or must be absent.</span>
<span class="cp"># The default is an absence period of 30 seconds.</span>
<span class="cp"># Example:</span>
<span class="cp">#   ABSENT_SECONDS = 30</span>
<span class="n">ABSENT_SECONDS</span> <span class="o">=</span> <span class="mi">300</span>

<span class="cp"># The powernap daemon will wake every INTERVAL_SECONDS and check for activity</span>
<span class="cp"># to all of the monitors.  Lower values of INTERVAL_SECONDS will provide</span>
<span class="cp"># more detailed process monitoring but will consume more system resources.</span>
<span class="cp"># Higher values of INTERVAL_SECONDS will consume less system resources, but</span>
<span class="cp"># might miss activity that execute for less than INTERVAL_SECONDS.</span>
<span class="cp"># The minimum runtime of any monitor should not be less than INTERVAL_SECONDS.</span>
<span class="cp"># The default interval is 1 second.</span>
<span class="cp"># Example:</span>
<span class="cp">#   INTERVAL_SECONDS = 1</span>
<span class="n">INTERVAL_SECONDS</span> <span class="o">=</span> <span class="mi">10</span>

<span class="cp"># Action to run when the monitor detects activity in the resource</span>
<span class="cp"># The default action is &quot;/var/lib/fogbow-opportunism/actions/openstack/stop-node&quot;</span>
<span class="n">RECOVER_ACTION</span> <span class="o">=</span> <span class="s">&quot;/var/lib/fogbow-opportunism/actions/openstack/stop-node&quot;</span>

<span class="cp"># Action to run when the resource is idle</span>
<span class="n">ACTION</span> <span class="o">=</span> <span class="s">&quot;/var/lib/fogbow-opportunism/actions/openstack/start-node&quot;</span>
</pre></div>


<p>Properties for monitors configuration</p>
<div class="highlight"><pre><span class="cp"># The [ConsoleMonitor] section enables or disables  monitoring of activity</span>
<span class="cp"># in the Console (tty), also tracking activity from any locally connected</span>
<span class="cp"># mouse and keyboard (PS2 Only).</span>
<span class="cp"># The default is enabled, set to &#39;y&#39;. It can be disabled by setting it to &#39;n&#39;.</span>
<span class="cp"># Examples:</span>
<span class="cp">#  console = y</span>
<span class="cp">#  console = n</span>
<span class="p">[</span><span class="n">ConsoleMonitor</span><span class="p">]</span>
<span class="n">ptmx</span> <span class="o">=</span> <span class="n">y</span>

<span class="cp"># The [PS2Monitor] section enables or disables monitoring of activity</span>
<span class="cp"># in the PS2 input devices (ex.: mouse and keyboard)</span>
<span class="p">[</span><span class="n">PS2Monitor</span><span class="p">]</span>
<span class="n">ps2</span> <span class="o">=</span> <span class="n">y</span>

<span class="cp"># The [InputMonitor] section lists the USB Input devices for which to track</span>
<span class="cp"># events. Currently, only two types of devices are supported, mouse and keyboard.</span>
<span class="cp"># Both InputMonitor&#39;s are enabled by default. In the case there are no USB</span>
<span class="cp"># devices connected, PowerNap will ignore these settings.</span>
<span class="cp"># To disable, set them to &quot;n&quot; or &quot;no&quot;, or simply comment them.</span>
<span class="cp"># Examples:</span>
<span class="cp">#  keyboard = n</span>
<span class="cp">#  keyboard = y</span>
<span class="p">[</span><span class="n">InputMonitor</span><span class="p">]</span>
<span class="n">keyboard</span> <span class="o">=</span> <span class="n">y</span>
<span class="n">mouse</span> <span class="o">=</span> <span class="n">y</span>

<span class="cp"># The [WoLMonitor] section lists all ports on which the WoL Monitor will be</span>
<span class="cp"># listening for WoL Packets for any of the network interfaces.</span>
<span class="cp"># Once a WoL Packet is received, the WoLMonitor will compare the data received</span>
<span class="cp"># with all the network interfaces (eth&#39;s) to determine wether it is destined</span>
<span class="cp"># for any of the network interfaces.</span>
<span class="cp"># The default is to monitor ports 7 and 9 for WoL data packets. It can also be</span>
<span class="cp"># set to any other port on which the machine is receiving WoL packets</span>
<span class="cp"># Example:</span>
<span class="cp">#  wol1052 = 1052</span>
<span class="p">[</span><span class="n">WoLMonitor</span><span class="p">]</span>
<span class="n">wol7</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">wol9</span> <span class="o">=</span> <span class="mi">9</span>

<span class="cp"># The [ProcessMonitor] section lists all the processes to Monitor by using</span>
<span class="cp"># regular expressions.</span>
<span class="cp"># Each item listed will be compared against the output of &quot;ps -eo args&quot;.</span>
<span class="cp"># The default is to monitor /sbin/init, which should always be running.</span>
<span class="cp"># Examples:</span>
<span class="cp">#  mplayer = &quot;mplayer &quot;</span>
<span class="cp">#  sshd = &quot;sshd: .*\[priv\]$&quot;</span>
<span class="cp">#  kvm = &quot;kvm &quot;</span>
<span class="p">[</span><span class="n">ProcessMonitor</span><span class="p">]</span>
<span class="n">init</span> <span class="o">=</span> <span class="s">&quot;^/sbin/init&quot;</span>

<span class="cp"># The [LoadMonitor] section defines the load threshold.  When the system load</span>
<span class="cp"># according to /proc/loadavg is above this value, then system will be deemed</span>
<span class="cp"># &#39;active&#39; and will not powernap.  If the system is already powernapping, then</span>
<span class="cp"># the system will awake out of the powernap mode if the load raises above the</span>
<span class="cp"># threshold.</span>
<span class="cp"># If the threshold is set to &quot;n&quot; (which is default), threshold is automatically</span>
<span class="cp"># calculated to be the number of online processors, as determined by:</span>
<span class="cp">#   getconf _NPROCESSORS_ONLN</span>
<span class="cp"># Example:</span>
<span class="cp">#   threshold = 1.5</span>
<span class="cp">#   threshold = 9999</span>
<span class="cp">#   threshold = 0</span>
<span class="cp">#   threshold = n</span>
<span class="p">[</span><span class="n">LoadMonitor</span><span class="p">]</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="n">n</span>

<span class="cp"># The [TCPMonitor] section lists all the TCP ports on which to watch for</span>
<span class="cp"># established connections using netstat(8). It supports both, single TCP</span>
<span class="cp"># as well as port ranges.</span>
<span class="cp"># There is no default TCP Monitor.</span>
<span class="cp"># Examples:</span>
<span class="cp">#  ssh = 22</span>
<span class="cp">#  http = 80</span>
<span class="cp">#  https = 443</span>
<span class="cp">#  other = 64500-65000</span>
<span class="p">[</span><span class="n">TCPMonitor</span><span class="p">]</span>
<span class="n">ssh</span> <span class="o">=</span> <span class="mi">22</span>

<span class="cp"># The [UDPMonitor] section lists all the UDP ports on which to listen</span>
<span class="cp"># for data.</span>
<span class="cp"># Each item listed will BIND a UDP port and listen to any data. Keep</span>
<span class="cp"># in mind that this port will be bined and no other application will</span>
<span class="cp"># be able to use this port.</span>
<span class="cp"># There is no default UDP Monitor.</span>
<span class="cp"># Examples:</span>
<span class="cp">#  udp-1 = 1025</span>
<span class="cp">#  udp-2 = 2048</span>
<span class="p">[</span><span class="n">UDPMonitor</span><span class="p">]</span>
<span class="n">udp</span><span class="o">-</span><span class="mi">1025</span> <span class="o">=</span> <span class="mi">1025</span>

<span class="cp"># The [IOMonitor] section lists all the processes to Monitor for IO</span>
<span class="cp"># activity. A regular expressions is used to find the processes PIDs, which</span>
<span class="cp"># are later used to monitor IO.</span>
<span class="cp"># There is no default IO Monitor.</span>
<span class="cp"># Examples:</span>
<span class="cp">#  kvm-io = &quot;kvm&quot;</span>
<span class="cp">#  mysqld-io = &quot;mysql&quot;</span>
<span class="p">[</span><span class="n">IOMonitor</span><span class="p">]</span>
<span class="n">kvm</span><span class="o">-</span><span class="n">io</span> <span class="o">=</span> <span class="s">&quot;kvm&quot;</span>
<span class="n">mysqld</span><span class="o">-</span><span class="n">io</span> <span class="o">=</span> <span class="s">&quot;mysql&quot;</span>

<span class="cp"># The [DiskMonitor] section lists the disk devices for which to track</span>
<span class="cp"># standby/sleep status.  If any of the devices are active/idle the</span>
<span class="cp"># system will be deemed &#39;active&#39; and will not powernap. Generally useful</span>
<span class="cp"># for monitoring data drives (e.g. NAS), but will not typically work to</span>
<span class="cp"># monitor the root drive. Note also that this plugin only reacts to the</span>
<span class="cp"># state of the drive and does not modify the behavior of the drive</span>
<span class="cp"># directly. Therefore it only makes sense to monitor a drive that has</span>
<span class="cp"># already been configured to standby or sleep.  </span>
<span class="cp"># To disable checking specific drives, set them to &quot;n&quot; or &quot;no&quot;,</span>
<span class="cp"># or simply comment them.</span>
<span class="cp"># Examples:</span>
<span class="cp">#  sda = y</span>
<span class="cp">#  sdb = n</span>
<span class="p">[</span><span class="n">DiskMonitor</span><span class="p">]</span>
<span class="n">sda</span> <span class="o">=</span> <span class="n">y</span>
</pre></div>
      </div>
    </div>
    </div>
      </div>
    </div>
    
    <footer class="footer">
      <div class="container">
      <div class="row">
	  <div class="col-lg-12">
	    <ul class="list-inline">
	      <li class="pull-right"><a href="#top">Back to top</a></li>
	      <li><a href="http://blog.fogbowcloud.org">Blog</a></li>
	      <li><a href="https://github.com/fogbow/">GitHub</a></li>
	      <li><a href="http://build.fogbowcloud.org">Build status</a></li>
	    </ul>
	    <p>Code released under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License Version 2.0</a>.</p>
	    <p>Based on <a href="http://getbootstrap.com" rel="nofollow">Bootstrap</a>. Icons from <a href="http://fortawesome.github.io/Font-Awesome/" rel="nofollow">Font Awesome</a>. Web fonts from <a href="http://www.google.com/webfonts" rel="nofollow">Google</a>.</p>
	  </div>
      </div>
      </div>
    </footer>

  </body>
</html>